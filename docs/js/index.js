let plan,$pane;const handleJson=e=>e.json(),handleText=e=>e.text(),fetchAsync=async e=>await(await fetch(e)).json(),$views=document.querySelector(".views"),$floorSelector=document.querySelector(".floor-selector"),$zoomSlider=document.querySelector(".zoom-slider"),$mirror=document.querySelector(".mirror"),$reverse=document.getElementById("reverse"),views=[],floorOptions=[],hideNode=e=>e.hidden=!0,selectFloor=e=>{const{target:t}=e;$floorSelector.classList.toggle("expand"),t.hidden&&(floorOptions.forEach(hideNode),views.forEach(hideNode),t.hidden=!1,$reverse.checked=!1,mirror(),$pane=$views.querySelector(t.dataset.ref),restore())},zoom=()=>document.body.style.setProperty("--zoom",$zoomSlider.value),wheel=({deltaY:e})=>{$zoomSlider.value=+$zoomSlider.value+(e>0?-4:4),zoom()},mirror=()=>{if($reverse.checked){const e=$pane.cloneNode(!0),t=e.querySelectorAll("[id^=te]"),o=(e,o)=>{const{left:r,right:n}=t[o].getBoundingClientRect();e.dataset.class=e.getAttribute("class")||"",e.style.setProperty("--translate-x",`${r+n}px`),e.setAttribute("class",`${e.dataset.class} text-flip`)};return e.classList.remove("view"),$mirror.appendChild(e),$pane.querySelectorAll("[id^=te]").forEach(o),e.remove()}$pane.querySelectorAll("[id^=te]").forEach(e=>e.setAttribute("class",e.dataset.class))},init=()=>{$pane.hidden=!1,setScale($pane),dragNode($pane)},restore=()=>{$zoomSlider.value=0,zoom(),init()},reset=()=>{$reverse.checked=!1,mirror(),restore()},setScale=e=>{if(void 0===e.dataset.scaled){const{width:t,height:o}=e.querySelector("svg").getBoundingClientRect(),r=Math.min(window.innerWidth/t,window.innerHeight/o);e.style.setProperty("--scale-x",r),e.style.setProperty("--scale-y",r),e.dataset.scaled=!0}},setFloor=e=>{const t=document.createElement("div"),o=document.createElement("li");return o.textContent=e.name,o.className="floor-option",floorOptions.push(o),t.hidden=o.hidden=!0,o.dataset.ref=`.view${views.length}`,t.className=`view view${views.length}`,$floorSelector.appendChild(o),views.push(t),$views.appendChild(t),fetch(e.src).then(handleText).then(e=>t.innerHTML=e)},dragNode=e=>{let t=0,o=0,r=0,n=0,l=0,s=0,i=[];const d=()=>{i=[],l=0,document.body.onpointermove=null},c=d=>{const[c,a,p]=i;if(!p){if(a){let e;d.pointerId===c.pointerId?(e=a,i[0]=d):(e=c,i[1]=d);const t=Math.hypot(e.clientX-d.clientX,e.clientY-d.clientY);return l=l||t,$zoomSlider.value=s+100*Math.min(1,t/l-1),zoom()}t=r-d.clientX,o=n-d.clientY,e.style.setProperty("--x",`${e.offsetLeft-t}px`),e.style.setProperty("--y",`${e.offsetTop-o}px`)}};e.style.setProperty("--x",0),e.style.setProperty("--y",0),document.body.onpointerdown=t=>{0===i.length&&t.target.closest(".views")&&(r=t.clientX-parseInt(getComputedStyle(e).getPropertyValue("--x")),n=t.clientY-parseInt(getComputedStyle(e).getPropertyValue("--y")),s=+$zoomSlider.value,document.body.onpointermove=c),i.push(t)},document.body.onpointerup=d,document.body.onpointercancel=d,document.body.onpointerout=d},loadPlan=async e=>{plan={...e},await setFloor(e.shift()),$pane=$views.firstElementChild,document.querySelector(".floor-option").hidden=!1,init(),$floorSelector.onclick=selectFloor,$zoomSlider.oninput=zoom,$views.onwheel=wheel,e.forEach(setFloor)};document.querySelector(".reset-button").onclick=reset,$reverse.onchange=mirror,fetch("plan.json").then(handleJson).then(loadPlan);