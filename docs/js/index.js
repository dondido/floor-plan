let plan,$pane;const handleJson=e=>e.json(),handleText=e=>e.text(),fetchAsync=async e=>await(await fetch(e)).json(),$views=document.querySelector(".views"),$floorSelector=document.querySelector(".floor-selector"),$zoomSlider=document.querySelector(".zoom-slider"),views=[],floorOptions=[],hideNode=e=>e.hidden=!0,selectFloor=e=>{const{target:t}=e;$floorSelector.classList.toggle("expand"),t.hidden&&(floorOptions.forEach(hideNode),views.forEach(hideNode),t.hidden=!1,$pane=document.getElementById(t.dataset.ref),reset())},zoom=()=>document.body.style.setProperty("--custom-scale",$zoomSlider.value),wheel=({deltaY:e})=>{$zoomSlider.value=+$zoomSlider.value+(e>0?-4:4),zoom()},init=()=>{$pane.hidden=!1,setScale($pane),dragNode($pane)},reset=()=>{$zoomSlider.value=0,zoom(),init()},setScale=e=>{if(void 0===e.dataset.scaled){const t=e.querySelector("svg"),{width:o,height:n}=t.getBoundingClientRect(),l=Math.min(window.innerWidth/o,window.innerHeight/n);t.style.setProperty("--default-scale",l),e.dataset.scaled=!0}},setFloor=e=>{const t=document.createElement("div"),o=document.createElement("li");return o.textContent=e.name,o.className="floor-option",floorOptions.push(o),t.hidden=o.hidden=!0,o.dataset.ref=t.id=`view${views.length}`,$floorSelector.appendChild(o),t.className="view",views.push(t),$views.appendChild(t),fetch(e.src).then(handleText).then(e=>t.innerHTML=e)},dragNode=e=>{let t=0,o=0,n=0,l=0,r=0,d=0,i=[];const s=()=>{i=[],r=0,document.body.onpointermove=null},c=s=>{const[c,a,p]=i;if(!p){if(a){let e;s.pointerId===c.pointerId?(e=a,i[0]=s):(e=c,i[1]=s);const t=Math.hypot(e.clientX-s.clientX,e.clientY-s.clientY);return r=r||t,$zoomSlider.value=d+100*Math.min(1,t/r-1),zoom()}t=n-s.clientX,o=l-s.clientY,e.style.setProperty("--x",`${e.offsetLeft-t}px`),e.style.setProperty("--y",`${e.offsetTop-o}px`)}};e.style.setProperty("--x",0),e.style.setProperty("--y",0),document.body.onpointerdown=t=>{0===i.length&&t.target.closest(".views")&&(n=t.clientX-parseInt(getComputedStyle(e).getPropertyValue("--x")),l=t.clientY-parseInt(getComputedStyle(e).getPropertyValue("--y")),d=+$zoomSlider.value,document.body.onpointermove=c),i.push(t)},document.body.onpointerup=s,document.body.onpointercancel=s,document.body.onpointerout=s},loadPlan=async e=>{plan={...e},await setFloor(e.shift()),$pane=document.querySelector(".view"),document.querySelector(".floor-option").hidden=!1,init(),$floorSelector.onclick=selectFloor,$zoomSlider.oninput=zoom,$views.onwheel=wheel,e.forEach(setFloor)};document.querySelector(".reset-button").onclick=reset,fetch("plan.json").then(handleJson).then(loadPlan);