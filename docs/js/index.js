let plan,$pane;const handleJson=e=>e.json(),handleText=e=>e.text(),fetchAsync=async e=>await(await fetch(e)).json(),$views=document.querySelector(".views"),$floorSelector=document.querySelector(".floor-selector"),$zoomSlider=document.querySelector(".zoom-slider"),views=[],floorOptions=[],hideNode=e=>e.hidden=!0,selectFloor=e=>{const{target:o}=e;$floorSelector.classList.toggle("expand"),o.hidden&&(floorOptions.forEach(hideNode),views.forEach(hideNode),o.hidden=!1,$pane=document.getElementById(o.dataset.ref),reset())},zoom=()=>document.body.style.setProperty("--custom-scale",$zoomSlider.value),wheel=({deltaY:e})=>{$zoomSlider.value=+$zoomSlider.value+(e>0?-4:4),zoom()},init=()=>{$pane.hidden=!1,setScale($pane),dragNode($pane)},reset=()=>{$zoomSlider.value=0,zoom(),init()},setScale=e=>{if(void 0===e.dataset.scaled){const o=e.querySelector("svg"),{width:t,height:n}=o.getBoundingClientRect(),l=Math.min(window.innerWidth/t,window.innerHeight/n);o.style.setProperty("--default-scale",l),e.dataset.scaled=!0}},setFloor=e=>{const o=document.createElement("div"),t=document.createElement("li");return t.textContent=e.name,t.className="floor-option",floorOptions.push(t),o.hidden=t.hidden=!0,t.dataset.ref=o.id=`view${views.length}`,$floorSelector.appendChild(t),o.className="view",views.push(o),$views.appendChild(o),fetch(e.src).then(handleText).then(e=>o.innerHTML=e)},dragNode=e=>{let o=0,t=0,n=0,l=0,d=0,r=0,i=[];const s=()=>{i=[],d=0,document.body.onpointermove=null},a=s=>{const[a,c,p]=i;if(!p){if(c){let e;s.pointerId===a.pointerId?(e=c,i[0]=s):(e=a,i[1]=s);const o=Math.hypot(e.clientX-s.clientX,e.clientY-s.clientY);return 0===d&&(d=o),$zoomSlider.value=r+100*Math.min(1,o/d-1),zoom()}o=n-s.clientX,t=l-s.clientY,e.style.setProperty("--x",`${e.offsetLeft-o}px`),e.style.setProperty("--y",`${e.offsetTop-t}px`)}};e.style.setProperty("--x",0),e.style.setProperty("--y",0),document.body.onpointerdown=o=>{0===i.length&&(n=o.clientX-parseInt(getComputedStyle(e).getPropertyValue("--x")),l=o.clientY-parseInt(getComputedStyle(e).getPropertyValue("--y")),r=+$zoomSlider.value,document.body.onpointermove=a),i.push(o)},document.body.onpointerup=s,document.body.onpointercancel=s,document.body.onpointerout=s},loadPlan=async e=>{plan={...e},await setFloor(e.shift()),$pane=document.querySelector(".view"),document.querySelector(".floor-option").hidden=!1,init(),$floorSelector.onclick=selectFloor,$zoomSlider.oninput=zoom,$views.onwheel=wheel,e.forEach(setFloor)};fetch("plan.json").then(handleJson).then(loadPlan);